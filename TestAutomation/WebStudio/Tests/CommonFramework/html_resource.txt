*** Settings ***

Documentation  A resource file containing the application specific keywords
...            that create our own domain specific language. This resource
...            implements keywords for testing HTML version of the test
...            application. Keywords for Flex version are in flex_resource.txt
...            and common_resource.txt is used to select which one to use.


*** Variables ***

${LOGIN URL}     http://172.24.201.221:8080/escenic
${WELCOME URL}   http://${SERVER}/html/welcome.html
${ERROR URL}     http://${SERVER}/html/error.html
${JENKINS URL}   http://172.24.201.221:8089


*** Keywords ***

Login To Web Studio
	#Open Browser To Escenic WebStudio
    	Input Environment Variable  userId  ECE_UserName
    	Input Environment Variable  password  ECE_Password
    	Submit Credentials
    	Click For Multiple Cookies

Login To Escenic Mobile Studio
    Open Browser To Escenic MobileStudio
    Input Environment Variable  userName  ECE_UserName
    Input Environment Variable  password  ECE_Password
    Submit Credentials
    Wait Until Page Contains Element  css=button[data-ng-click="save()"]
    Page Should Contain Button  Draft

Login To CUE
    Close Existing Browser Window  ${BROWSER}
    Open Browser To Escenic Common Framework  ${BROWSER}
    Maximize Browser Window
    Set Window Size  1600  1600
    Wait Until Page Contains Element  css=input[id="username"]
    Input Environment Variable  username  ECE_CF_UserName
    Input Environment Variable  password  ECE_CF_Password
    Click Button  css=input[id="login"]
    Wait Until Angular Ready   15s
    Switch To CUE  ${BROWSER}

Log Off From CUE
    Wait Until Page Contains Element  css=a[ng-click='vm.logout()']
    Click Element  css=a[ng-click='vm.logout()']
    Wait Until Page Contains Element  css=input[value='Login']
    Page Should Contain Element  css=input[value='Login']

Log Off From Escenic Mobile Studio
    Click Element  css=div[class='logo']
    Click Element  css=a[href="#/logout"]
    Page Should Contain Button  css=button[class="login"]

Open New Editor
    Click Element  css=div[class='logo']
    Click Element  css=a[href="#/editor/new"]

Open Browser To Login Page
    Open Browser  ${LOGIN URL}  ${BROWSER}
    Maximize Browser Window
    Set Selenium Speed  ${DELAY}
    Title Should Be  Escenic Web Studio

Open Browser To Escenic MobileStudio
    Open Browser MobileStudio
    Maximize Browser Window
    Set Selenium Speed  ${DELAY}
    	Title Should Be  Mobile Studio

Go To Login Page
    Go To  ${LOGIN URL}
    Title Should Be  Login Page

Go To Change Password Page
    Click Link  xpath=//*[@href='/escenic/person/changePassword.do']  
 
Go To Change Language Page
    Click Link  xpath=//*[@href='/escenic/base/changeLanguage.do']  

Go To Link  [Arguments]  ${url}
    Click Link  xpath=//*[@href='${url}']

Go To WebStudio HomePage
	Go To Link  javascript:submitForm("main-menu")

Input Username  [Arguments]  ${username}
    Input Text  username_field  ${username}

Input Password  [Arguments]  ${password}
    Input Text  password_field  ${password}

Submit Credentials
    Click Button  Log in

Welcome Page Should Be Open
    Location Should Be  ${WELCOME URL}
    Title Should Be  Welcome Page

Login Should Have Failed
    Location Should Be  ${ERROR URL}
    Title Should Be  Error Page

Click For Multiple Cookies
    Click Element If Exists  css=button[class='hijack']

Check if Log off Link Exists
    Page Should Contain Link  xpath=//*[@href='/escenic/logoff.do']

Create User  [Arguments]  ${userName}
    Go To Link  javascript:submitForm("main-menu")
    Click Element  xpath=//*[@href="/escenic/user/new.do"]
    Input Text  firstName  ${userName}
    Input Text  surName  ${userName}
    Input Text  userName  ${userName}
    Input Text  newPassword  ${userName}
    Input Text  confirmPassword  ${userName}
    Click Element  xpath=//*[@value='Save']
	Alert Should Not Be Present
	##Click Search button and check if new user exists
	#Go To WebStudio HomePage
	#Click Element  xpath=//*[@href="javascript:submitForm('person-archive')"]
	Wait Until Page Contains  Person archive  50  error=None
	Page Should Contain Button  Search
	#Click Element  xpath=//*[@value='Search']
	#Wait Until Page Contains  View person  50  error=None
	#Click Element  xpath=//*[@value='Search']
	#Wait Until Page Contains  View person  10  error=None
	#Page Should Contain  View person

Create Section  [Arguments]  ${sectionName}
	Go To Link  javascript:submitForm("section-archive")
	Click Element  xpath=//*[@value='Search']
	Click Element  xpath=//*[@href="javascript:submitForm('redirect:/section/view.do?id=1')"]
	Go To Link  /escenic/section/new.do?id=1
	Input Text  name  ${sectionName}
	Input Text  uniqueName  ece_${sectionName}
	Click Element  xpath=//*[@value='Save']
		Alert Should Not Be Present
		#Assertion Check
		Page Should Contain Button  Search
		Click Element  xpath=//*[@value='Search']
		Wait Until Page Contains  ${sectionName}  10  error=None
		Page Should Contain  ${sectionName}

Delete Section  [Arguments]  ${sectionName}
	Go To Link  javascript:submitForm("section-archive")
	#Click Element  xpath=//*[@href="javascript:submitForm('redirect:/section/view.do?id=3')"
	Input Text  searchString  ${sectionName}
	Click Element  xpath=//*[@value='Search']
	Click Element  xpath=//a[.='Administer']
	Click Element  xpath=//a[.='Delete']
	Click Element  xpath=//a[.='Delete']
	Click Element  xpath=//*[@href="javascript:submitForm('delete')"]
		#Assertion Check
		Page Should Not Contain  ${sectionName} (ID:

Assign Global Role  [Arguments]  ${userName}  ${role}
	Go To WebStudio HomePage
	Click Element  xpath=//*[@href="javascript:submitForm('person-archive')"]
	Click Element  xpath=//a[.='${userName} ${userName}']
	Click Element  xpath=//*[@href="javascript:submitForm('editGlobalRoles')"]
	Select Checkbox   xpath=//*[@name="globalRole(${role})"]
	Click Element  xpath=//*[@value='Save']

Assign Section Role  [Arguments]  ${userName}  ${role}
	Go To WebStudio HomePage
	Click Element  xpath=//*[@href="javascript:submitForm('person-archive')"]
	Click Element  xpath=//a[.='${userName} ${userName}']
	Click Element  xpath=//*[@href="javascript:submitForm('editRoles')"]
	Select Checkbox   xpath=//*[@name="relatedObject(0001).attribute(${role})"]
	Click Element  xpath=//*[@value='Save']

Assign All Global Roles  [Arguments]  ${userName}
	Go To WebStudio HomePage
	Click Element  xpath=//*[@href="javascript:submitForm('person-archive')"]
	Click Element  xpath=//a[.='${userName} ${userName}']
	Click Element  xpath=//*[@href="javascript:submitForm('editGlobalRoles')"]
	Select Checkbox   xpath=//*[@name="globalRole(publicationadmin)"]
	Select Checkbox   xpath=//*[@name="globalRole(administrator)"]
	Select Checkbox   xpath=//*[@name="globalRole(useradmin)"]
	Select Checkbox   xpath=//*[@name="globalRole(editor)"]
	Select Checkbox   xpath=//*[@name="globalRole(journalist)"]
	Select Checkbox   xpath=//*[@name="globalRole(reader)"]
	Select Checkbox   xpath=//*[@name="globalRole(articleWithContentTypeReader)"]
	Select Checkbox   xpath=//*[@name="globalRole(articleWithContentTypeWriter)"]
	Select Checkbox   xpath=//*[@name="globalRole(dashboard-administrator)"]
	Select Checkbox   xpath=//*[@name="globalRole(content-moderator)"]
	Click Element  xpath=//*[@value='Save']

Assign All Section Roles  [Arguments]  ${userName}
	Go To WebStudio HomePage
	Click Element  xpath=//*[@href="javascript:submitForm('person-archive')"]
	Click Element  xpath=//a[.='${userName} ${userName}']
	Click Element  xpath=//*[@href="javascript:submitForm('editRoles')"]
	Select Checkbox   xpath=//*[@name="relatedObject(0001).attribute(administrator)"]
	Select Checkbox   xpath=//*[@name="relatedObject(0001).attribute(useradmin)"]
	Select Checkbox   xpath=//*[@name="relatedObject(0001).attribute(editor)"]
	Select Checkbox   xpath=//*[@name="relatedObject(0001).attribute(journalist)"]
	Select Checkbox   xpath=//*[@name="relatedObject(0001).attribute(reader)"]
	Click Element  xpath=//*[@value='Save']

	
Delete User  [Arguments]  ${userName}
	Go To WebStudio HomePage
	Click Element  xpath=//*[@href="javascript:submitForm('person-archive')"]
	Input Text  searchWord  ${userName}
	Click Button  Search
	Click Element If Exists  css=input[value='on']
	Click Element If Exists  css=a[href='javascript: confirmDelete()']
	Close Alert If Exists
	Click Link If Exists  css=a[href^="/escenic/person/search/deletePersons.do?deletePossible=true"]
	Page Should Not Contain  These items could not be deleted


Create Story  [Arguments]  ${inputText}
	Click Element  css=#top>div.left>div.new-content-toggler
	Wait Until Page Contains Element  css=div.story  30
	Click Element  css=div.story
        Wait Until Angular Ready   15s
	Wait Until Page Contains Element  css=div[title="new-story: New Story"]
	Input Text  css=textarea[placeholder="Title"]  ${inputText}
	Input Text  css=textarea[placeholder="Subtitle"]  ${inputText}
	#Input Text  css=textarea[placeholder="Lead text"]  ${inputText}
	Wait Until Element Is Visible  css=div[data-placeholder="Body"]  15
	Input Text Into Rich Text Editor  css=div[data-placeholder="Body"]  ${inputText}
	Click Button  css=div[class*="new-story"] >div>div>div>div:nth-child(2)>input#save
	Wait Until Angular Ready   15s

Create Picture Content  [Arguments]  ${inputText}
	Click Element  css=#top>div.left>div.new-content-toggler
	Wait Until Page Contains Element  css=div.picture  30
	Click Element  css=div.picture
	Wait For  5
	Type Text  *jpg
	#Click Element  css=div[class="splash-button new-picture ng-scope"]
	#Wait Until Element is Visible  css=div[class="splash-button new-picture ng-scope"]
	#Choose File  css=div[class="splash-button new-picture ng-scope"]  'C:\Users\Public\Pictures\Sample Pictures\Lighthouse.jpg'
	Type Key  ENTER
	Wait Until Page Contains Element  css=textarea[placeholder="File Name"]  30
	Input Text  css=textarea[placeholder="File Name"]  ${inputText}
	Input Text  css=textarea[placeholder="Lead text"]  ${inputText}
	Input Text  css=textarea[placeholder="Caption"]  ${inputText}
	Input Text  css=textarea[placeholder="Alternative text"]  ${inputText}
	Click Button  css=div[class*="picture"] >div>div>div>div:nth-child(2)>input#save
	Wait Until Angular Ready   15s

Create Video Content  [Arguments]  ${inputText}
	Click Element  css=#top>div.left>div.new-content-toggler
	Input Text  css=input.new-content-search--input  Video
	Click Element  css=a[title="Create new Video"]
	Type Text  Video test.mp4
	Type Key  ENTER
	Wait Until Page Contains  Select Pipeline  90
	Input Text  css=textarea[placeholder="Title"]  ${inputText}
	Input Text  css=textarea[placeholder="Lead text"]  ${inputText}
	Click Element  css=div[class*="video"] >div>div>div>div:nth-child(2)>input#save
	Wait Until Angular Ready   15s

Publish video
	Click Element  css=div[class*="video"]>div>div>div>div:nth-child(2)>input#publish
	Wait Until Page Contains Element  css=div.right>span.approved  5

Watch Preview
	Wait Until Element Is Visible  css=div[ng-if="vm.content.links && vm.content.links['alternate']"]>div[class="right"]  15
    	${previewUrl}=  Get Element Attribute  css=a[ng-href*="http"]@ng-href
    	Log Off From CUE
    	Close Browser
    	Open Browser  ${previewUrl}  ${BROWSER}
    	Maximize Browser Window

Search in CUE  [Arguments]  ${inputText}
	Click Element  css=#panels .tabs > .search
	Click Element  css=#search span.reset
    	Input Text  css=input[name="search"]  ${inputText}
    	Wait Until Angular Ready   15s

Publish Story
	Wait Until Element Is Visible  css=div[class*="new-story"] >div>div>div>div:nth-child(2)>input#publish  15
	Click Button  css=div[class*="new-story"]>div>div>div>div:nth-child(2)>input#publish
	Wait Until Angular Ready   15s
	Wait Until Page Contains Element  xpath=//div//span[contains(text(), 'Published')]  15


Publish Picture
	Wait Until Element Is Visible  css=div[class*="picture"] >div>div>div>div:nth-child(2)>input#publish  15
	Click Button  css=div[class*="picture"]>div>div>div>div:nth-child(2)>input#publish
	Wait Until Angular Ready   15s
	Wait Until Page Contains Element  xpath=//div//span[contains(text(), 'Published')]  15
	

CUE Should Not Show any alert
	Page Should Not Contain Element  css=#pop.active  There was an unexpected alert found
	

